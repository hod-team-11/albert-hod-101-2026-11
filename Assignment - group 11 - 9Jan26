
Group 11 Slack Assignment - 9 Jan 2026
"""
Part 1 – Post a hello message to Slack using the Web API
"""
## Allows us to read environment variables (where the Slack token is stored securely).
import os
## Lets us print useful messages (info or errors) while the program runs.
import logging
## Imports Slack’s official Python client to talk to Slack’s Web API.
from slack_sdk import WebClient
## Lets us catch and handle errors returned by Slack (for example, wrong token or permissions).
from slack_sdk.errors import SlackApiError
## Reads the bot token from the environment instead of writing it in the code (for security reasons).
SLACK_BOT_TOKEN = os.environ.get("SLACK_BOT_TOKEN")

if not SLACK_BOT_TOKEN:
    raise ValueError("SLACK_BOT_TOKEN environment variable is not set")

## Stops the program immediately if the token is missing, so we know what went wrong.
## Stores the Slack channel ID where the message will be sent.
CHANNEL_ID = "C0A79R6BCUX"
## Sets the logging level so we can see informative messages while the script runs.

logging.basicConfig(level=logging.INFO)
## Creates a Slack client using our bot token.This client is used to send requests to Slack.
client = WebClient(token=SLACK_BOT_TOKEN)

##Starts a block where we attempt to send a message and catch errors if something fails.
## Uses Slack’s Web API to post a text message to the chosen channel.
## Prints a confirmation message if the message was sent correctly.
## Catches errors from Slack and prints an error message with details.
  ## Prints the exact error message returned by Slack to help debugging.
try:
        client.chat_postMessage(
        channel=CHANNEL_ID,
        text="Hello world, this is group 11"
    )
    logging.info("Message posted successfully")
    except SlackApiError as e:
    logging.error(f"Slack API error: {e.response['error']}")
# ============================================================================

PART 2:
##  Import Required Libraries AS IN PART 1
import os
import logging
from slack_sdk import WebClient
from slack_sdk.errors import SlackApiError

##Initialize Slack Client
SLACK_BOT_TOKEN = os.environ.get("SLACK_BOT_TOKEN")
CHANNEL_ID = "YOUR_CHANNEL_ID"  # replace with your channel id
client = WebClient(token=SLACK_BOT_TOKEN)

## Define Folder and Valid Extensions
IMAGE_FOLDER = "pictures"
VALID_EXTENSIONS = (".png", ".jpg", ".jpeg", ".gif", ".bmp")
##note: Only images should be uploaded, not PDFs or text files and Extensions are case-insensitive (.JPG is fine too)
## Check the Folder Exists

if not os.path.isdir(IMAGE_FOLDER):
    raise FileNotFoundError(f"Folder '{IMAGE_FOLDER}' does not exist")

## Loop Through the Images

for filename in os.listdir(IMAGE_FOLDER):
    
    if not filename.lower().endswith(VALID_EXTENSIONS):
        continue  # skip non-images
    
    file_path = os.path.join(IMAGE_FOLDER, filename)

    try:
        client.files_upload_v2(
            channel=CHANNEL_ID,
            file=file_path,
            title=filename,
            initial_comment=f"Here is an image: {filename}"
        )
        logging.info(f"Uploaded image: {filename}")

    except SlackApiError as e:
        logging.error(f"Failed to upload {filename}: {e.response['error']}")

## Ensure Logging & Safety: Helps you see which images were uploaded
logging.basicConfig(level=logging.INFO)

## Test: send a "ready" message after all images are uploaded

try:
    client.chat_postMessage(
        channel=CHANNEL_ID,
        text="group _11 ready to browse Wikipedia"
    )
    logging.info("Posted ready message after image uploads")
except SlackApiError as e:
    logging.error(f"Failed to post ready message: {e.response['error']}")

PART 3
## Install Wikipedia library
pip install wikipedia

## Add import statements
import wikipedia
import time

## Define a simple helper function
def fetch_wikipedia_intro():
    """
    Fetches the first paragraph of a Wikipedia page.
    Returns an error message if the page is not found.
    """
    try:
        page = wikipedia.page(title)
        # Split content into paragraphs and return the first non-empty one
        paragraphs = page.content.split('\n')
        for para in paragraphs:
            if para.strip():
                return para.strip()
        return "Sorry, the page exists but no content found."
    except wikipedia.exceptions.PageError:
        return f"Sorry, Wikipedia page '{title}' does not exist."
    except wikipedia.exceptions.DisambiguationError as e:
        return f"Multiple options found for '{title}': {e.options[:5]}..."
    except Exception as e:
        return f"Error fetching Wikipedia page: {str(e)}"

## Naive polling loop for new messages

# Keep track of last message timestamp to avoid duplicate responses
last_timestamp = None

while True:
    try:
        # Get the last 10 messages from the channel
        response = client.conversations_history(
            channel=CHANNEL_ID,
            limit=10
        )
        messages = response['messages']

        # Process messages in reverse (oldest first)
        for message in reversed(messages):
            ts = message['ts']
            user = message.get('user')
            text = message.get('text', '')

            # Only respond to new messages after last_timestamp
            if last_timestamp is None or ts > last_timestamp:
                if text.startswith("Wikipedia:"):
                    title = text.replace("Wikipedia:", "").strip()
                    answer = fetch_wikipedia_intro(title)
                    client.chat_postMessage(
                        channel=CHANNEL_ID,
                        text=answer
                    )
                    logging.info(f"Responded to Wikipedia query: {title}")

                last_timestamp = ts

        # Wait 5 seconds before checking again
        time.sleep(5)

    except SlackApiError as e:
        logging.error(f"Slack API error: {e.response['error']}")
        time.sleep(5)  # Wait before retrying
    except Exception as e:
        logging.error(f"Error: {str(e)}")
        time.sleep(5)
